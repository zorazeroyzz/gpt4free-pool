<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeAPI Pool - 免费API流量池管理</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div id="app">
        <!-- 侧边栏遮罩 -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
        <!-- 侧边栏 -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
                            <rect width="28" height="28" rx="8" fill="url(#logo-grad)"/>
                            <path d="M8 14L12 10L16 14L20 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 18L12 14L16 18L20 14" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" opacity="0.6"/>
                            <defs>
                                <linearGradient id="logo-grad" x1="0" y1="0" x2="28" y2="28">
                                    <stop stop-color="#6366F1"/>
                                    <stop offset="1" stop-color="#8B5CF6"/>
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <div class="logo-text">
                        <span class="logo-title">FreeAPI Pool</span>
                        <span class="logo-subtitle">免费API流量池</span>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard" onclick="switchPage('dashboard')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
                    <span>控制面板</span>
                </a>
                <a href="#" class="nav-item" data-page="providers" onclick="switchPage('providers')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                    <span>提供商管理</span>
                </a>
                <a href="#" class="nav-item" data-page="models" onclick="switchPage('models')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                    <span>模型列表</span>
                </a>
                <a href="#" class="nav-item" data-page="playground" onclick="switchPage('playground')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <span>对话测试</span>
                </a>
                <a href="#" class="nav-item" data-page="apikeys" onclick="switchPage('apikeys')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.78 7.78 5.5 5.5 0 0 1 7.78-7.78zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
                    <span>API密钥</span>
                </a>
                <a href="#" class="nav-item" data-page="docs" onclick="switchPage('docs')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                    <span>接口文档</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="server-status">
                    <div class="status-dot online"></div>
                    <span>服务运行中</span>
                </div>
                <span class="version">v1.0.0</span>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 顶部栏 -->
            <header class="topbar">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                </button>
                <div class="topbar-title" id="pageTitle">控制面板</div>
                <div class="topbar-actions">
                    <div class="api-endpoint">
                        <code>http://localhost:8080/v1</code>
                        <button class="btn-icon" onclick="copyEndpoint()" title="复制API地址">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                        </button>
                    </div>
                </div>
            </header>

            <!-- 页面内容 -->
            <div class="page-content">

                <!-- ======== 控制面板页面 ======== -->
                <div class="page active" id="page-dashboard">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="stat-requests">0</span>
                                <span class="stat-label">总请求数</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon green">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="stat-success">0%</span>
                                <span class="stat-label">成功率</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon purple">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="stat-models">0</span>
                                <span class="stat-label">可用模型</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            </div>
                            <div class="stat-info">
                                <span class="stat-value" id="stat-providers">0/0</span>
                                <span class="stat-label">活跃提供商</span>
                            </div>
                        </div>
                    </div>

                    <!-- 提供商状态概览 -->
                    <div class="card">
                        <div class="card-header">
                            <h3>提供商状态概览</h3>
                            <button class="btn btn-sm" onclick="refreshDashboard()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
                                刷新
                            </button>
                        </div>
                        <div class="provider-overview" id="providerOverview">
                            <div class="loading">加载中...</div>
                        </div>
                    </div>

                    <!-- 快速开始 -->
                    <div class="card">
                        <div class="card-header">
                            <h3>快速开始</h3>
                        </div>
                        <div class="quickstart">
                            <div class="code-block">
                                <div class="code-header">
                                    <span>Python (OpenAI SDK)</span>
                                    <button class="btn-icon" onclick="copyCode('code-python')">复制</button>
                                </div>
                                <pre id="code-python"><code>from openai import OpenAI

client = OpenAI(
    base_url="http://localhost:8080/v1",
    api_key="free"  # 任意字符串即可
)

response = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[{"role": "user", "content": "你好！"}],
    stream=True,
)

for chunk in response:
    if chunk.choices[0].delta.content:
        print(chunk.choices[0].delta.content, end="")</code></pre>
                            </div>
                            <div class="code-block">
                                <div class="code-header">
                                    <span>cURL</span>
                                    <button class="btn-icon" onclick="copyCode('code-curl')">复制</button>
                                </div>
                                <pre id="code-curl"><code>curl http://localhost:8080/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4o-mini",
    "messages": [{"role": "user", "content": "你好！"}],
    "stream": false
  }'</code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ======== 提供商管理页面 ======== -->
                <div class="page" id="page-providers">
                    <div class="card">
                        <div class="card-header">
                            <h3>提供商管理</h3>
                            <div class="header-actions">
                                <button class="btn btn-sm btn-primary" onclick="checkAllHealth()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                                    全部检测
                                </button>
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>提供商</th>
                                        <th>状态</th>
                                        <th>模型数</th>
                                        <th>请求数</th>
                                        <th>成功率</th>
                                        <th>平均延迟</th>
                                        <th>需要认证</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="providersTableBody">
                                    <tr><td colspan="8" class="loading">加载中...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ======== 模型列表页面 ======== -->
                <div class="page" id="page-models">
                    <div class="model-filters">
                        <button class="filter-btn active" onclick="filterModels('all')">全部</button>
                        <button class="filter-btn" onclick="filterModels('chat')">对话</button>
                        <button class="filter-btn" onclick="filterModels('reasoning')">推理</button>
                        <button class="filter-btn" onclick="filterModels('code')">代码</button>
                        <button class="filter-btn" onclick="filterModels('vision')">视觉</button>
                        <button class="filter-btn" onclick="filterModels('image')">图像生成</button>
                        <button class="filter-btn" onclick="filterModels('audio')">音频</button>
                    </div>
                    <div class="models-grid" id="modelsGrid">
                        <div class="loading">加载中...</div>
                    </div>
                </div>

                <!-- ======== 对话测试页面 ======== -->
                <div class="page" id="page-playground">
                    <div class="playground-layout">
                        <div class="playground-sidebar">
                            <div class="form-group">
                                <label>模型</label>
                                <select id="playgroundModel" class="form-select">
                                    <option value="gpt-4o-mini">GPT-4o Mini</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>提供商（可选）</label>
                                <select id="playgroundProvider" class="form-select">
                                    <option value="">自动选择</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>温度: <span id="tempValue">0.7</span></label>
                                <input type="range" id="playgroundTemp" min="0" max="2" step="0.1" value="0.7" oninput="document.getElementById('tempValue').textContent=this.value">
                            </div>
                            <div class="form-group">
                                <label>流式输出</label>
                                <label class="toggle">
                                    <input type="checkbox" id="playgroundStream" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <button class="btn btn-danger btn-block" onclick="clearChat()">清空对话</button>
                        </div>
                        <div class="playground-main">
                            <div class="chat-messages" id="chatMessages">
                                <div class="chat-welcome">
                                    <div class="welcome-icon">
                                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                                    </div>
                                    <h3>对话测试</h3>
                                    <p>选择模型并开始对话，测试API流量池的响应效果</p>
                                </div>
                            </div>
                            <div class="chat-input-area">
                                <textarea id="chatInput" placeholder="输入消息..." rows="1" onkeydown="handleChatKeydown(event)"></textarea>
                                <button class="btn btn-primary send-btn" id="sendBtn" onclick="sendMessage()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ======== API密钥页面 ======== -->
                <div class="page" id="page-apikeys">
                    <div class="card">
                        <div class="card-header">
                            <h3>API 密钥管理</h3>
                            <button class="btn btn-sm btn-primary" onclick="generateApiKey()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                                生成新密钥
                            </button>
                        </div>
                        <div class="api-keys-info">
                            <div class="info-banner">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                                <p>当前为开放模式，所有请求均可访问。如需限制访问，可生成API密钥并开启认证模式。密钥格式兼容 OpenAI API Key 规范。</p>
                            </div>
                        </div>
                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>密钥名称</th>
                                        <th>密钥</th>
                                        <th>创建时间</th>
                                        <th>使用次数</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="apiKeysTableBody">
                                    <tr>
                                        <td colspan="6" class="empty-state">
                                            <p>暂无API密钥。当前为开放访问模式。</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ======== 接口文档页面 ======== -->
                <div class="page" id="page-docs">
                    <div class="card">
                        <div class="card-header"><h3>API 接口文档</h3></div>
                        <div class="docs-content">
                            <h4>基础信息</h4>
                            <table class="info-table">
                                <tr><td class="label">Base URL</td><td><code>http://localhost:8080/v1</code></td></tr>
                                <tr><td class="label">协议格式</td><td>兼容 OpenAI API 格式</td></tr>
                                <tr><td class="label">认证方式</td><td>Bearer Token（当前开放模式，任意字符串即可）</td></tr>
                            </table>

                            <h4>端点列表</h4>

                            <div class="endpoint">
                                <div class="endpoint-header">
                                    <span class="method get">GET</span>
                                    <code>/v1/models</code>
                                    <span class="endpoint-desc">获取可用模型列表</span>
                                </div>
                            </div>

                            <div class="endpoint">
                                <div class="endpoint-header">
                                    <span class="method post">POST</span>
                                    <code>/v1/chat/completions</code>
                                    <span class="endpoint-desc">对话补全（支持流式）</span>
                                </div>
                                <div class="endpoint-body">
                                    <h5>请求参数</h5>
                                    <table class="params-table">
                                        <tr><td><code>model</code></td><td>string</td><td>必填</td><td>模型名称，如 "gpt-4o-mini"</td></tr>
                                        <tr><td><code>messages</code></td><td>array</td><td>必填</td><td>消息列表 [{role, content}]</td></tr>
                                        <tr><td><code>stream</code></td><td>boolean</td><td>可选</td><td>是否流式输出，默认 false</td></tr>
                                        <tr><td><code>temperature</code></td><td>float</td><td>可选</td><td>温度参数，0-2，默认 0.7</td></tr>
                                        <tr><td><code>max_tokens</code></td><td>integer</td><td>可选</td><td>最大输出token数，默认 4096</td></tr>
                                        <tr><td><code>provider</code></td><td>string</td><td>可选</td><td>指定提供商名称（扩展字段）</td></tr>
                                    </table>
                                </div>
                            </div>

                            <div class="endpoint">
                                <div class="endpoint-header">
                                    <span class="method get">GET</span>
                                    <code>/api/providers</code>
                                    <span class="endpoint-desc">获取所有提供商状态</span>
                                </div>
                            </div>

                            <div class="endpoint">
                                <div class="endpoint-header">
                                    <span class="method post">POST</span>
                                    <code>/api/providers/{name}/toggle</code>
                                    <span class="endpoint-desc">启用/禁用指定提供商</span>
                                </div>
                            </div>

                            <div class="endpoint">
                                <div class="endpoint-header">
                                    <span class="method get">GET</span>
                                    <code>/api/stats</code>
                                    <span class="endpoint-desc">获取总体统计数据</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Toast 通知 -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="/static/js/app.js"></script>
</body>
</html>
